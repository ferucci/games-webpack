(()=>{"use strict";const t=t=>t!==document.body&&document.body.contains(t),e="index-slider__line",s="draggable",i="index-slider__dots-box",n="index-slider__dot",r="dot-active",d="index-slider__btn-left",a="index-slider__btn-right",o="index-slider__btn-disabled";class h{constructor(t,e={}){this.containerNode=t,this.size=t.childElementCount,this.currentSlide=0,this.currentSlideWasChanged=!1,this.settings={margin:e.margin||0,innerElementsClass:e.innerElementsClass||null,arrow:e.arrow||!1,dots:e.dots||!1,popupEl:e.popupElem||null},this.manageHTML=this.manageHTML.bind(this),this.setParameters=this.setParameters.bind(this),this.setEvents=this.setEvents.bind(this),this.resize=this.resize.bind(this),this.startDrag=this.startDrag.bind(this),this.stopDrag=this.stopDrag.bind(this),this.dragging=this.dragging.bind(this),this.setStylePosition=this.setStylePosition.bind(this),this.progressBar=this.progressBar.bind(this),this.clickDots=this.clickDots.bind(this),this.moveToLeft=this.moveToLeft.bind(this),this.moveToRight=this.moveToRight.bind(this),this.changeActiveDotClass=this.changeActiveDotClass.bind(this),this.changeCurrentSlide=this.changeCurrentSlide.bind(this),this.changeDisabledBtn=this.changeDisabledBtn.bind(this),this.manageHTML(),this.setParameters(),this.setEvents()}manageHTML(){this.containerNode.classList.add("index-slider"),this.containerNode.innerHTML=`\n      <div class="${e}">\n        ${this.containerNode.innerHTML}\n      </div>\n        <div class="index-slider__btns">\n          <button class="${d}"></button>\n          <button class="${a}"></button>\n        </div>\n      <div class="index-slider__dots">\n        <div class="${i}"></div>\n      </div>\n    `,this.lineNode=this.containerNode.querySelector(`.${e}`),this.dotsNode=this.containerNode.querySelector(`.${i}`),this.slideNodes=Array.from(this.lineNode.children).map((t=>function({element:t,className:e}){const s=document.createElement("div");return s.classList.add(e),t.parentNode.insertBefore(s,t),s.appendChild(t),s}({element:t,className:"index-slider__item"}))),this.containerNode.matches(".top-slider__inner")?this.dotsNode.innerHTML=Array.from(Array(this.size).keys()).map((t=>`<button class="${n} ${t===this.currentSlide?r:""}"></button>`)).join(""):this.dotsNode.innerHTML=`<button class="${n}"></button>`,this.dotsNodes=this.dotsNode.querySelectorAll(`.${n}`),this.btnLeft=document.querySelector(`.${d}`),this.btnRight=document.querySelector(`.${a}`)}setParameters(){const t=this.containerNode.getBoundingClientRect();this.innerItemsName=this.containerNode.querySelectorAll(`.${this.settings.innerElementsClass}`),this.innerItemsName&&document.documentElement.scrollWidth<975&&this.containerNode.matches(".slider__items")?(this.innerItemsName.forEach(((t,e)=>{this.width=t.scrollWidth})),this.settings.margin=0,this.size=3*this.innerItemsName.length):this.innerItemsName&&document.documentElement.scrollWidth>975?(this.size=this.innerItemsName.length,this.width=t.width,this.currentSlide=Math.floor(this.currentSlide/3),this.settings.margin=this.settings.margin+5):this.width=t.width-this.settings.margin,this.containerNode.matches("#slider-popup")&&this.innerItemsName.forEach(((t,e)=>{this.width=t.scrollWidth})),this.maximumX=-(this.size-1)*(this.width+this.settings.margin),this.x=-this.currentSlide*(this.width+this.settings.margin),this.resetStyleTransition(),this.lineNode.style.width=this.size*(this.width+this.settings.margin)+"px",this.setStylePosition(),this.changeDisabledBtn(),Array.from(this.slideNodes).forEach((t=>{t.style.width=`${this.width}px`,t.style.marginRight=`${this.settings.margin}px`}))}setEvents(){this.debonceResize=function(t,e=200){let s;return function(i){clearTimeout(s),s=setTimeout(t,e,i)}}(this.resize),window.addEventListener("resize",this.debonceResize),this.lineNode.addEventListener("pointerdown",this.startDrag),window.addEventListener("pointerup",this.stopDrag),window.addEventListener("pointercancel",this.stopDrag),this.containerNode.matches(".top-slider__inner")&&this.dotsNode.addEventListener("click",this.clickDots),this.btnLeft.addEventListener("click",this.moveToLeft),this.btnRight.addEventListener("click",this.moveToRight),null!==this.settings.popupEl&&this.settings.popupEl.forEach((t=>{t.addEventListener("click",this.debonceResize)}))}destroyEvents(){window.removeEventListener("resize",this.debonceResize),this.lineNode.removeEventListener("pointerdown",this.startDrag),window.removeEventListener("pointerup",this.stopDrag),window.removeEventListener("pointercancel",this.stopDrag),this.dotsNode.removeEventListener("click",this.clickDots),this.btnLeft.removeEventListener("click",this.moveToLeft),this.btnRight.removeEventListener("click",this.moveToRight)}resize(){this.setParameters(),this.setStylePosition()}startDrag(t){this.currentSlideWasChanged=!1,this.clickX=t.pageX,this.startX=this.x,this.resetStyleTransition(),this.containerNode.classList.add(s),window.addEventListener("pointermove",this.dragging)}stopDrag(){window.removeEventListener("pointermove",this.dragging),this.containerNode.classList.remove(s),this.changeCurrentSlide()}dragging(t){this.dragX=t.pageX;const e=this.dragX-this.clickX,s=e/5;this.x=Math.max(Math.min(e+this.startX,s),this.maximumX+s),this.setStylePosition(),e>7&&e>0&&!this.currentSlideWasChanged&&this.currentSlide>0&&(this.currentSlideWasChanged=!0,this.currentSlide=this.currentSlide-1),e<-7&&e<0&&!this.currentSlideWasChanged&&this.currentSlide<this.size-1&&(this.currentSlideWasChanged=!0,this.currentSlide=this.currentSlide+1)}clickDots(t){if(this.containerNode.matches(".top-slider__inner")){const e=t.target.closest("button");if(!e)return;let s;for(let t=0;t<this.dotsNodes.length;t++)if(this.dotsNodes[t]===e){s=t;break}if(s==this.currentSlide)return;const i=Math.abs(this.currentSlide-s);this.currentSlide=s,this.changeCurrentSlide(i)}}moveToRight(){this.currentSlide>=this.size-1||(this.currentSlide=this.currentSlide+1,this.changeCurrentSlide())}moveToLeft(){this.currentSlide<=0||(this.currentSlide=this.currentSlide-1,this.changeCurrentSlide())}progressBar(){this.dotsNode.children[0].style.width=parseFloat(100*(this.currentSlide+1)/this.size)+"%"}changeCurrentSlide(t){this.x=-this.currentSlide*(this.width+this.settings.margin),this.setStylePosition(),this.setStyleTransition(t),this.containerNode.matches(".top-slider__inner")?this.changeActiveDotClass():this.progressBar(),this.changeDisabledBtn()}changeActiveDotClass(){for(let t=0;t<this.dotsNodes.length;t++)this.dotsNodes[t].classList.remove(r);this.dotsNodes[this.currentSlide].classList.add(r)}changeDisabledBtn(){this.currentSlide<=0?this.btnLeft.classList.add(o):this.btnLeft.classList.remove(o),this.currentSlide>=this.size-1?this.btnRight.classList.add(o):this.btnRight.classList.remove(o)}setStylePosition(){document.documentElement.scrollWidth<975&&this.containerNode.matches(".slider__items")?this.lineNode.style.transform=`translate3d(${this.x/3+this.settings.margin}px, 0, 0)`:this.lineNode.style.transform=`translate3d(${this.x}px, 0, 0)`}setStyleTransition(t=1){this.lineNode.style.transition=`all ${.25*t}s ease 0s`}resetStyleTransition(){this.lineNode.style.transition="all 0s ease 0s"}}var c,l;c="slider-header",l=t=>new h(t,{margin:15,innerElementsClass:"top-slider__item",dots:!0}),"loading"!==document.readyState?t(document.getElementById(c))&&l(document.getElementById(c)):document.addEventListener("DOMContentLoaded",(function(){t(document.getElementById(c))&&l(document.getElementById(c))})),(()=>{let t=document.querySelectorAll(".game-card__action-incard");const e=document.querySelector(".basket-content__games");t=document.querySelectorAll(".game-card__action-incard");let s=0;const i=new class{#t=[];addItem(t){this.#t.push(t),this.save()}removeItem(t){const e=this.#t.findIndex((e=>e.id===t.id));-1!==e&&(this.#t.splice(e,1),this.save())}getItems(){return this.#t}save(){localStorage.setItem("cart",JSON.stringify(this.#t))}load(){const t=localStorage.getItem("cart");t&&(this.#t=JSON.parse(t))}};function n(){const t=i.getItems().length;document.querySelector(".basket__num").textContent=t}i.load(),n(),document.getElementById("basket-page")&&setTimeout((function(){i.getItems().forEach((t=>{var s,i,n,r;e.insertAdjacentHTML("afterbegin",(s=t.img,i=t.title,n=t.price,`\n\n    <div class="basket-content__game" data-id="${r=t.id}">\n      <div class="basket-content__game-info">\n          <img class="basket-content__game-image"\n            src="${s}" alt="game image prev">\n          <div class="basket-content__game-text">\n              <span class="basket-content__game-name">\n                ${i}\n              </span>\n              <span class="basket-content__game-sum">\n                ${n}\n              </span>\n          </div>\n      </div>\n      <div class="basket-content__game-select">\n          <button class="basket-content__game-del" aria-label="Удалить товар">\n              <img src="./images/icons/btn-delete.svg" alt=""></button>\n          <div class="basket-content__select-app">\n              <div class="basket-content__select-wrapp">\n\n                  <div id="select-${r}">\n\n                  </div>\n\n                </div>\n          </div>\n      </div>\n  </div> `)),(t=>{new Select(`#select-${t}`,{placeholder:"Выберите способ покупки",selectedId:"1",data:[{id:"1",value:"Аренда через семейный доступ"},{id:"2",value:"Аренда через личный доступ"}],onSelect(t){}})})(t.id)})),document.querySelectorAll(".basket-content__game-del").forEach((t=>{t.addEventListener("click",(t=>{const e=t.currentTarget,s=e.parentNode.closest(".basket-content__game");console.log(e),console.log(s);const r={id:s.dataset.id};s.remove(),i.removeItem(r),n()}))}))}),500),t.forEach((t=>{t.closest(".game-card").setAttribute("data-id",++s),t.addEventListener("click",(t=>{const e=(t=>({title:t.querySelector(".game-card__title").textContent,price:t.querySelector(".game-card__sum").textContent,img:t.querySelector(".game-card__img").getAttribute("src"),id:t.dataset.id}))(t.currentTarget.parentNode.closest(".game-card"));i.addItem(e),n()}))}))})()})();