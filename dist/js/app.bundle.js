(()=>{"use strict";class e{constructor(e,t){this.elem=document.querySelector(e),this.elem&&(this.options=t,this.selectedId=t.selectedId,this.#e(),this.#t())}#e(){const{placeholder:e,data:t}=this.options;this.elem.classList.add("select"),this.elem.innerHTML=((e=[],t,s)=>{let n=t??"Placeholder default";const a=e.map((e=>{let t="";return e.id===s&&(n=e.value,t="selected"),`\n    <li class="select__item ${t}" data-type="item" data-id="${e.id}">${e.value}</li>`}));return`\n        <div class="select__backdrop" data-type="backdrop"></div>\n        <div class="select__input" data-type="input">\n            <span data-type="value">${n}</span>\n            <span class="triangle-icon-open" data-type="arrow"></span>\n          </div>\n          <div class="select__dropdown">\n            <ul class="select__list">\n              ${a.join("")}\n            </ul>\n        </div>\n    `})(t,e,this.selectedId)}#t(){this.clickHandler=this.clickHandler.bind(this),this.elem.addEventListener("click",this.clickHandler),this.arrow=this.elem.querySelector('[data-type="arrow"]'),this.value=this.elem.querySelector('[data-type="value"]')}clickHandler(e){const{type:t}=e.target.dataset;if("input"===t||e.target.closest(".select__input"))document.querySelectorAll(".select").forEach((e=>{if(e.closest(".select-open")){e.classList.remove("select-open");const t=e.querySelector(".triangle-icon-close");t.classList.remove("triangle-icon-close"),t.classList.add("triangle-icon-open")}})),this.toggle();else if("item"===t){const t=e.target.dataset.id;this.select(t)}else"backdrop"===t&&this.close()}get isOpen(){return this.elem.classList.contains("select-open")}get current(){return this.options.data.find((e=>e.id===this.selectedId))}select(e){this.selectedId=e,this.value.textContent=this.current.value,this.elem.querySelectorAll('[data-type="item"]').forEach((e=>{e.classList.remove("selected")})),this.elem.querySelector(`[data-id="${e}"]`).classList.add("selected"),this.options.onSelect&&this.options.onSelect(this.current),this.close()}toggle(){this.isOpen?this.close():this.open()}open(){this.elem.classList.add("select-open"),this.arrow.classList.remove("triangle-icon-open"),this.arrow.classList.add("triangle-icon-close")}close(){this.elem.classList.remove("select-open"),this.arrow.classList.remove("triangle-icon-close"),this.arrow.classList.add("triangle-icon-open")}destroy(){this.elem.removeEventListener("click",this.clickHandler),this.elem.innerHTML=""}}let t=document.querySelectorAll(".game-card__action-incard");const s=()=>{const s=document.querySelector(".basket-content__games");t=document.querySelectorAll(".game-card__action-incard");let n=0;const a=new class{#s=[];addItem(e){this.#s.push(e),this.save()}removeItem(e){const t=this.#s.findIndex((t=>t.id===e.id));-1!==t&&(this.#s.splice(t,1),this.save())}getItems(){return this.#s}save(){localStorage.setItem("cart",JSON.stringify(this.#s))}load(){const e=localStorage.getItem("cart");e&&(this.#s=JSON.parse(e))}};function i(){const e=a.getItems().length;document.querySelector(".basket__num").textContent=e}a.load(),i(),document.getElementById("basket-page")&&setTimeout((function(){a.getItems().forEach((t=>{var n,a,i,c;s.insertAdjacentHTML("afterbegin",(n=t.img,a=t.title,i=t.price,`\n\n    <div class="basket-content__game" data-id="${c=t.id}">\n      <div class="basket-content__game-info">\n          <img class="basket-content__game-image"\n            src="${n}" alt="game image prev">\n          <div class="basket-content__game-text">\n              <span class="basket-content__game-name">\n                ${a}\n              </span>\n              <span class="basket-content__game-sum">\n                ${i}\n              </span>\n          </div>\n      </div>\n      <div class="basket-content__game-select">\n          <button class="basket-content__game-del" aria-label="Удалить товар">\n              <img src="./images/icons/btn-delete.svg" alt=""></button>\n          <div class="basket-content__select-app">\n              <div class="basket-content__select-wrapp">\n\n                  <div id="select-${c}">\n\n                  </div>\n\n                </div>\n          </div>\n      </div>\n  </div> `)),(t=>{new e(`#select-${t}`,{placeholder:"Выберите способ покупки",selectedId:"1",data:[{id:"1",value:"Аренда через семейный доступ"},{id:"2",value:"Аренда через личный доступ"}],onSelect(e){}})})(t.id)})),document.querySelectorAll(".basket-content__game-del").forEach((e=>{e.addEventListener("click",(e=>{const t=e.currentTarget,s=t.parentNode.closest(".basket-content__game");console.log(t),console.log(s);const n={id:s.dataset.id};s.remove(),a.removeItem(n),i()}))}))}),500),t.forEach((e=>{e.closest(".game-card").setAttribute("data-id",++n),e.addEventListener("click",(e=>{const t=(e=>({title:e.querySelector(".game-card__title").textContent,price:e.querySelector(".game-card__sum").textContent,img:e.querySelector(".game-card__img").getAttribute("src"),id:e.dataset.id}))(e.currentTarget.parentNode.closest(".game-card"));a.addItem(t),i()}))}))};document.addEventListener("DOMContentLoaded",(function(){s()}))})();