(()=>{"use strict";var e={433:(e,t,s)=>{function n(e,t=200){let s;return function(n){clearTimeout(s),s=setTimeout(e,t,n)}}s.d(t,{RA:()=>n})}},t={};function s(n){var a=t[n];if(void 0!==a)return a.exports;var c=t[n]={exports:{}};return e[n](c,c.exports,s),c.exports}s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{class e{constructor(e,t){this.elem=document.querySelector(e),this.elem&&(this.options=t,this.selectedId=t.selectedId,this.#e(),this.#t())}#e(){const{placeholder:e,data:t}=this.options;this.elem.classList.add("select"),this.elem.innerHTML=((e=[],t,s)=>{let n=t??"Placeholder default";const a=e.map((e=>{let t="";return e.id===s&&(n=e.value,t="selected"),`\n    <li class="select__item ${t}" data-type="item" data-id="${e.id}">${e.value}</li>`}));return`\n        <div class="select__backdrop" data-type="backdrop"></div>\n        <div class="select__input" data-type="input">\n            <span data-type="value">${n}</span>\n            <span class="triangle-icon-open" data-type="arrow"></span>\n          </div>\n          <div class="select__dropdown">\n            <ul class="select__list">\n              ${a.join("")}\n            </ul>\n        </div>\n    `})(t,e,this.selectedId)}#t(){this.clickHandler=this.clickHandler.bind(this),this.elem.addEventListener("click",this.clickHandler),this.arrow=this.elem.querySelector('[data-type="arrow"]'),this.value=this.elem.querySelector('[data-type="value"]')}clickHandler(e){const{type:t}=e.target.dataset;if("input"===t||e.target.closest(".select__input"))document.querySelectorAll(".select").forEach((e=>{if(e.closest(".select-open")){e.classList.remove("select-open");const t=e.querySelector(".triangle-icon-close");t.classList.remove("triangle-icon-close"),t.classList.add("triangle-icon-open")}})),this.toggle();else if("item"===t){const t=e.target.dataset.id;this.select(t)}else"backdrop"===t&&this.close()}get isOpen(){return this.elem.classList.contains("select-open")}get current(){return this.options.data.find((e=>e.id===this.selectedId))}select(e){this.selectedId=e,this.value.textContent=this.current.value,this.elem.querySelectorAll('[data-type="item"]').forEach((e=>{e.classList.remove("selected")})),this.elem.querySelector(`[data-id="${e}"]`).classList.add("selected"),this.options.onSelect&&this.options.onSelect(this.current),this.close()}toggle(){this.isOpen?this.close():this.open()}open(){this.elem.classList.add("select-open"),this.arrow.classList.remove("triangle-icon-open"),this.arrow.classList.add("triangle-icon-close")}close(){this.elem.classList.remove("select-open"),this.arrow.classList.remove("triangle-icon-close"),this.arrow.classList.add("triangle-icon-open")}destroy(){this.elem.removeEventListener("click",this.clickHandler),this.elem.innerHTML=""}}var t=s(433);const n=()=>{let s=document.querySelectorAll(".game-card__action-incard");const n=document.querySelector(".basket-content__games");s=document.querySelectorAll(".game-card__action-incard");const a=new class{#s=[];addItem(e){this.#s.push(e),this.save()}removeItem(e){const t=this.#s.findIndex((t=>t.id===e.id));-1!==t&&(this.#s.splice(t,1),this.save())}getItems(){return this.#s}save(){localStorage.setItem("cart",JSON.stringify(this.#s))}load(){const e=localStorage.getItem("cart");e&&(this.#s=JSON.parse(e))}};a.load();const c=()=>{const e=a.getItems().length;document.querySelector(".basket__num").textContent=e};if(c(),document.getElementById("basket-page")){console.log(a.getItems());const s=document.getElementById("form-basket"),i=()=>{0!==a.getItems().length&&document.documentElement.scrollWidth>1310?s.style.display="block":s.style.display="none"},l=e=>{const t=e.querySelector(".form-basket__total-sum > span"),s=e.querySelector(".form-basket__total-items > span"),n=document.querySelectorAll(".basket-content__game");if(i(),n){const e=Number((l=a.getItems(),l.reduce(((e,t)=>e+t.price.trim().slice(0,-1).replace(/,/g,".")*parseInt(t.quantity,10)),0))).toFixed(3),n=Number(function(e){return e.reduce(((e,t)=>e+parseInt(t.quantity,10)),0)}(a.getItems()));a.getItems().length>0&&(t.innerText=`${c=String(e),c.replace(/\./g,",")} ₽`,s.innerText=n)}var c,l},r=(e,t)=>{const n=document.querySelector(".delete__wrapp"),i=r=>{const o=document.querySelector('[aria-label="Удалить"]');r.target===o&&null!==e?(e.remove(),a.removeItem(t),c(),l(s)):(r.target.closest(".light-btn")||r.target.closest(".popup__close-item")||r.target!==n)&&(t=null,e=null,n.removeEventListener("click",i))};n.addEventListener("click",i)};a.getItems().forEach((t=>{var s,a,c,i,l;n.insertAdjacentHTML("afterbegin",(s=t.img,a=t.title,c=t.price,i=t.id,l=t.quantity,`\n    <div class="basket-content__game" data-id="${i}">\n      <div class="basket-content__game-info">\n          <img class="basket-content__game-image"\n            src="${s}" alt="game image prev">\n          <div class="basket-content__game-text">\n              <span class="basket-content__game-name">\n                ${a.trim()}\n              </span>\n              <span class="basket-content__game-sum">\n                ${c.trim()}\n              </span>\n              <div class="basket-content__control btns-control">\n                  <button class="btns-control__item" type="button" data-action="minus">-</button>\n                  <div class="btns-control__current" data-counter>${l}</div>\n                  <button class="btns-control__item" type="button" data-action="plus">+</button>\n              </div>\n          </div>\n      </div>\n      <div class="basket-content__game-select">\n          <button class="basket-content__game-del" aria-label="Удалить товар" data-path="deleteItem-path">\n              <img src="./images/icons/btn-delete.svg" alt=""></button>\n          <div class="basket-content__select-app">\n              <div class="basket-content__select-wrapp">\n\n                  <div id="select-${i}">\n\n                  </div>\n\n                </div>\n          </div>\n      </div>\n  </div> `)),(t=>{new e(`#select-${t}`,{placeholder:"Выберите способ покупки",selectedId:"1",data:[{id:"1",value:"Аренда через семейный доступ"},{id:"2",value:"Аренда через личный доступ"}]})})(t.id)})),document.querySelectorAll(".basket-content__game-del").forEach((e=>{e.addEventListener("click",(e=>{const t=e.currentTarget.parentNode.closest(".basket-content__game"),s={id:t.dataset.id};r(t,s)}))})),l(s);const o=()=>{document.querySelectorAll(".btns-control").forEach((e=>{const t=e.querySelector("[data-counter]"),s=e.querySelector('[data-action="minus"]');1===parseInt(t.innerText)?(s.style.color="rgb(0 141 210 / 32%)",s.disabled=!0):(s.style.color="#008dd2",s.disabled=!1)}))};o(),n.addEventListener("click",(e=>{if(!e.target.dataset.action)return;const t=e.target.closest(".btns-control").querySelector("[data-counter]"),n=e.target.parentNode.closest(".basket-content__game");"plus"===e.target.dataset.action&&(t.innerText=++t.innerText,a.getItems().forEach((e=>{n.dataset.id===e.id&&(e.quantity+=1),a.save()})),c()),"minus"===e.target.dataset.action&&parseInt(t.innerText,10)>1&&(t.innerText=--t.innerText,a.getItems().forEach((e=>{n.dataset.id===e.id&&e.quantity--,a.save()})),c()),o(),l(s)})),window.addEventListener("resize",(0,t.RA)(i))}s.forEach((e=>{e.addEventListener("click",(e=>{const t={title:(s=e.currentTarget.parentNode.closest(".game-card")).querySelector(".game-card__title").textContent,price:s.querySelector(".game-card__sum").textContent,img:s.querySelector(".game-card__img").getAttribute("src"),id:s.dataset.id,quantity:1};var s;a.getItems().some((e=>e.id===t.id||e.title===t.title))?a.getItems().forEach((e=>{const s=e;t.id===e.id&&(s.quantity+=1),a.save()})):a.addItem(t),c()}))}))};document.addEventListener("DOMContentLoaded",(()=>{n()}))})()})();